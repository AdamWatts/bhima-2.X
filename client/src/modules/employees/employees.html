<div class="flex-header">
  <div class="bhima-title">
    <ol class="headercrumb">
      <li class="static">{{ "TREE.PAYROLL" | translate }}</li>
      <li class="title">{{ "EMPLOYEE.TITLE" | translate }}</li>
    </ol>
  </div>
</div>

<div class="flex-content">
  <div class="container-fluid">
    <form 
      name="EmployeeRegistrationForm"
      bh-submit="EmployeeCtrl.submit(EmployeeRegistrationForm)"
      bh-form-defaults
      novalidate>
      <div class="row">
        <div class="form-horizontal" ng-form="DetailForm">
          <div class="col-md-7">
            <div class="panel panel-primary">
              <div class="panel-heading">{{ "EMPLOYEE.EMPLOYEE_DETAILS" | translate }}</div>
              <div class="panel-body">
                <div class="form-horizontal" ng-form="DetailForm">
                  <!-- Employee names  -->
                  <div
                    class="form-group"
                    ng-class="{'has-error' : DetailForm.display_name.$invalid && EmployeeRegistrationForm.$submitted}">

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.EMPLOYEE_NAME" | translate }}</label>
                    <div class="col-md-9">
                      <input
                        class="form-control"
                        ng-maxlength="EmployeeCtrl.maxLength"
                        name="display_name"
                        ng-model="EmployeeCtrl.employee.display_name"
                        autocomplete="off"
                        required>
                      <div class="help-block" ng-messages="DetailForm.display_name.$error" ng-show="EmployeeRegistrationForm.$submitted">
                        <div ng-messages-include="modules/templates/messages.tmpl.html"></div>
                      </div>
                    </div>
                  </div>
                  <!-- Employee date for birth  -->
                  <div class="form-group"
                    ng-class="{'has-error' : DetailForm.dob.$invalid && EmployeeRegistrationForm.$submitted}">
                    <label class="col-md-3 control-label">{{ "FORM.LABELS.DOB" | translate }}</label>
                    <div class="col-md-9">
                      <div class="input-group">
                        <input
                        name="dob"
                        type="text"
                        class="form-control"
                        ng-model="EmployeeCtrl.employee.dob"
                        uib-datepicker-popup="{{EmployeeCtrl.datepickerOptions.format}}"
                        datepicker-options="EmployeeCtrl.datepickerOptions"
                        is-open="EmployeeCtrl.datePopupIsOpen"
                        show-button-bar="false"
                        bh-date-validator="EmployeeCtrl.datepickerOptions"
                        autocomplete="off"
                        required>
                        <span class="input-group-btn">
                          <button type="button" class="btn btn-default" ng-click="EmployeeCtrl.datePopupIsOpen = !PatientRegCtrl.datePopupIsOpen">
                            <i class="fa fa-calendar-plus-o"></i>
                          </button>
                        </span>
                      </div>

                      <div class="help-block" ng-messages="DetailForm.dob.$error" data-date-error ng-if="EmployeeRegistrationForm.$submitted && DetailForm.dob.$invalid">
                        <div ng-messages-include="modules/templates/dates.messages.tmpl.html"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Gender -->
                  <div id="gender" class="form-group"
                    ng-class="{'has-error' : DetailForm.genderOptions.$invalid && EmployeeRegistrationForm.$submitted}">
                    <label class="col-md-3 control-label"> {{ "FORM.LABELS.GENDER" | translate }} </label>
                    <div class="col-md-9">
                      <label class="radio-inline">
                        <input type="radio" name="genderOptions" id="male" value="M" ng-model="EmployeeCtrl.employee.sexe" required>
                        {{ "FORM.LABELS.MALE" | translate }}
                      </label>

                      <label class="radio-inline">
                        <input type="radio" name="genderOptions" id="female" value="F" ng-model="EmployeeCtrl.employee.sexe" required>
                        {{ "FORM.LABELS.FEMALE" | translate }}
                      </label>

                      <div class="help-block" ng-messages="DetailForm.genderOptions.$error" ng-show="EmployeeRegistrationForm.$submitted">
                        <div ng-messages-include="modules/templates/messages.tmpl.html"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Employee code  -->
                  <div
                    class="form-group"
                    ng-class="{'has-error' : DetailForm.code.$invalid && EmployeeRegistrationForm.$submitted}">

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.CODE" | translate }}</label>
                    <div class="col-md-9">
                      <input
                        class="form-control"
                        ng-maxlength="EmployeeCtrl.length20"
                        name="code"
                        ng-model="EmployeeCtrl.employee.code"
                        autocomplete="off"
                        required>
                      <div class="help-block" ng-messages="DetailForm.code.$error" ng-show="EmployeeRegistrationForm.$submitted">
                        <div ng-messages-include="modules/templates/messages.tmpl.html"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Employee grade-->
                  <div class="form-group"
                    ng-class="{'has-error' : DetailForm.grade.$invalid && EmployeeRegistrationForm.$submitted}">

                    <!-- Warning for incomplete data - the page will not be able to continue -->
                    <uib-alert class="text-danger" type="danger" ng-if="EmployeeCtrl.grades.length === 0">
                      <i class="fa fa-warning"></i>
                      {{ "FORM.LABELS.NO_GRADE" | translate }} <b>{{ "FORM.LABELS.CONTACT_ADMIN" | translate }}</b>
                    </uib-alert>

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.GRADE" | translate }}</label>
                    <div class="col-md-9">
                      <ui-select
                        name="grade_id"
                        ng-model="EmployeeCtrl.employee.grade_id"
                        required>
                        <ui-select-match placeholder="{{ 'FORM.SELECT.GRADE' | translate }}"><span>{{$select.selected.text}}</span></ui-select-match>
                        <ui-select-choices ui-select-focus-patch repeat="g.uuid as g.format for g in (EmployeeCtrl.grades | filter:$select.search | orderBy:'text')">
                          <span ng-bind-html="g.text | highlight:$select.search"></span>
                        </ui-select-choices>
                      </ui-select>

                      <div class="help-block" ng-messages="DetailForm.grade_id.$error" ng-show="EmployeeRegistrationForm.$submitted">
                        <div ng-messages-include="modules/templates/messages.tmpl.html"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Employee Hospital File Number -->
                  <div
                    class="form-group has-feedback"
                    ng-class="{'has-error' : DetailForm.hospitalNumber.$invalid && EmployeeRegistrationForm.$submitted || DetailForm.hospitalNumber.$error.unique}">

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.HOSPITAL_FILE_NR" | translate }} </label>
                    <div class="col-md-9">
                      <input
                        name="hospitalNumber"
                        class="form-control"
                        ng-model="EmployeeCtrl.employee.hospital_no"
                        bh-unique="/patients/hospital_number"
                        ng-maxlength="EmployeeCtrl.length20"
                        autocomplete="off"
                        required>

                      <span ng-show="DetailForm.hospitalNumber.$error.unique" class="glyphicon glyphicon-remove form-control-feedback" id="unique-error-icon"></span>
                      <span ng-show="DetailForm.hospitalNumber.$pending.unique"  class="glyphicon glyphicon-hourglass form-control-feedback"></span>

                      <div class="help-block" ng-messages="DetailForm.hospitalNumber.$error" ng-show="DetailForm.$submitted || DetailForm.hospitalNumber.$error.unique">
                        <p ng-messages-include="modules/templates/messages.tmpl.html"></p>
                      </div>
                    </div>
                  </div>

                  <!-- Employee creditor group-->
                  <div class="form-group"
                    ng-class="{'has-error' : DetailForm.creditor_group_uuid.$invalid && EmployeeRegistrationForm.$submitted}">

                    <!-- Warning for incomplete data - the page will not be able to continue -->
                    <uib-alert class="text-danger" type="danger" ng-if="EmployeeCtrl.creditorGroups.length === 0">
                      <i class="fa fa-warning"></i>
                      {{ "FORM.LABELS.NO_CREDITOR_GROUP" | translate }} <b>{{ "FORM.LABELS.CONTACT_ADMIN" | translate }}</b>
                    </uib-alert>

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.CREDITOR_GROUP" | translate }}</label>
                    <div class="col-md-9">
                      <ui-select
                        name="creditor_group_uuid"
                        ng-model="EmployeeCtrl.employee.creditor_group_uuid"
                        required>
                        <ui-select-match placeholder="{{ 'FORM.SELECT.CREDITOR_GROUP' | translate }}"><span>{{$select.selected.name}}</span></ui-select-match>
                        <ui-select-choices ui-select-focus-patch repeat="cg.uuid as cg.name for cg in EmployeeCtrl.creditorGroups | filter:$select.search | orderBy:'name'">
                          <span ng-bind-html="cg.name | highlight:$select.search"></span>
                        </ui-select-choices>
                      </ui-select>

                      <div class="help-block" ng-messages="DetailForm.creditor_group_uuid.$error" ng-show="EmployeeRegistrationForm.$submitted">
                        <div ng-messages-include="modules/templates/messages.tmpl.html"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Employee debtor group-->
                  <div class="form-group"
                    ng-class="{'has-error' : DetailForm.debtor_group_uuid.$invalid && EmployeeRegistrationForm.$submitted}">

                    <!-- Warning for incomplete data - the page will not be able to continue -->
                    <uib-alert class="text-danger" type="danger" ng-if="EmployeeCtrl.debtorGroups.length === 0">
                      <i class="fa fa-warning"></i>
                      {{ "FORM.LABELS.NO_DEBTOR_GROUP" | translate }} <b>{{ "FORM.LABELS.CONTACT_ADMIN" | translate }}</b>
                    </uib-alert>

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.DEBTOR_GROUP" | translate }}</label>
                    <div class="col-md-9">
                      <ui-select
                        name="debtor_group_uuid"
                        ng-model="EmployeeCtrl.employee.debtor_group_uuid"
                        required>
                        <ui-select-match placeholder="{{ 'FORM.SELECT.DEBTOR_GROUP' | translate }}"><span>{{$select.selected.name}}</span></ui-select-match>
                        <ui-select-choices ui-select-focus-patch repeat="dg.uuid as dg.name for dg in EmployeeCtrl.debtorGroups | filter:$select.search | orderBy:'name'">
                          <span ng-bind-html="dg.name | highlight:$select.search"></span>
                        </ui-select-choices>
                      </ui-select>

                      <div class="help-block" ng-messages="DetailForm.debtor_group_uuid.$error" ng-show="EmployeeRegistrationForm.$submitted">
                        <div ng-messages-include="modules/templates/messages.tmpl.html"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Employee location -->
                  <div class="row">
                    <div class="col-md-5 col-md-offset-1">
                      <h4>{{ "FORM.LABELS.ORIGIN_LOCATION" | translate }}</h4>
                      <bh-location-select
                        id="origin-location-id"
                        validation-trigger="EmployeeRegistrationForm.$submitted"
                        location-uuid="EmployeeCtrl.employee.origin_location_id">
                      </bh-location-select>
                    </div>

                    <!-- separate location searches given a certain screen size -->
                    <div class="visible-sm-block visible-xs-block"><hr></div>

                    <div class="col-md-5 col-md-offset-1">
                      <h4>{{ "FORM.LABELS.CURRENT_LOCATION" | translate }}</h4>
                      <bh-location-select
                        id="current-location-id"
                        validation-trigger="EmployeeRegistrationForm.$submitted"
                        location-uuid="EmployeeCtrl.employee.current_location_id">
                      </bh-location-select>
                    </div>
                  </div>                  
                </div>
                <!-- submit button-->
                <div class="panel-footer text-right">
                  <bh-loading-button loading-state="EmployeeRegistrationForm.$loading">
                    {{ "FORM.BUTTONS.REGISTER_EMPLOYEE" | translate }}
                  </bh-loading-button>
                </div>
              </div>
            </div>            
          </div>
          <div class="col-md-5">
            <div class="panel panel-default">
              <div class="panel-heading">{{ "FORM.LABELS.OPTIONAL_INFO" | translate }}</div>
              <div class="panel-body">    
                <div class="form-horizontal" ng-form="OptionalForm">
                  <!-- Employee number of spouse-->
                  <div class="form-group"
                    ng-class="{'has-error' : OptionalForm.nb_spouse.$invalid && EmployeeRegistrationForm.$submitted}">

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.NB_SPOUSE" | translate }}</label>
                    <div class="col-md-9">
                      <input
                        type="number"
                        class="form-control"
                        name="nb_spouse"
                        ng-model="EmployeeCtrl.employee.nb_spouse"
                        autocomplete="off">
                     <div class="help-block" ng-messages="OptionalForm.nb_spouse.$error" ng-show="EmployeeRegistrationForm.$submitted">
                      <div ng-messages-include="modules/templates/messages.tmpl.html"></div>
                     </div>
                    </div>
                  </div>

                  <!-- Employee number of child-->
                  <div class="form-group"
                    ng-class="{'has-error' : OptionalForm.nb_enfant.$invalid && EmployeeRegistrationForm.$submitted}">

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.NB_ENFANT" | translate }}</label>
                    <div class="col-md-9">
                      <input
                        type="number"
                        class="form-control"
                        name="nb_enfant"
                        ng-model="EmployeeCtrl.employee.nb_enfant"
                        autocomplete="off">
                     <div class="help-block" ng-messages="OptionalForm.nb_enfant.$error" ng-show="EmployeeRegistrationForm.$submitted">
                      <div ng-messages-include="modules/templates/messages.tmpl.html"></div>
                     </div>
                    </div>
                  </div>

                  <!-- Employee locked state-->
                  <div class="form-group"
                    ng-class="{'has-error' : OptionalForm.locked.$invalid && EmployeeRegistrationForm.$submitted}">
                    <label class="control-label">
                      <input
                        type="checkbox"
                        name="locked"
                        ng-true-value="1"
                        ng-false-value="0"
                        ng-model="EmployeeCtrl.employee.locked">
                        {{ "FORM.LABELS.LOCKED" | translate }}
                      
                    </label>
                  </div>

                  <!-- Employee service-->
                  <div class="form-group"
                    ng-class="{'has-error' : DetailForm.service_id.$invalid && EmployeeRegistrationForm.$submitted}">

                    <uib-alert class="text-danger" type="danger" ng-if="EmployeeCtrl.services.length === 0">
                      <i class="fa fa-warning"></i>
                      {{ "FORM.LABELS.SERVICE" | translate }} <b>{{ "FORM.LABELS.CONTACT_ADMIN" | translate }}</b>
                    </uib-alert>

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.SERVICE" | translate }}</label>
                    <div class="col-md-9">
                      <ui-select
                        name="service_id"
                        ng-model="EmployeeCtrl.employee.service_id">
                        <ui-select-match placeholder="{{ 'FORM.SELECT.SERVICE' | translate }}"><span>{{$select.selected.name}}</span></ui-select-match>
                        <ui-select-choices ui-select-focus-patch repeat="sv.id as sv.name for sv in EmployeeCtrl.services | filter:$select.search | orderBy:'name'">
                          <span ng-bind-html="sv.name | highlight:$select.search"></span>
                        </ui-select-choices>
                      </ui-select>
                    </div>
                  </div>

                  <!-- Employee function-->
                  <div class="form-group"
                    ng-class="{'has-error' : DetailForm.fonction_id.$invalid && EmployeeRegistrationForm.$submitted}">

                    <uib-alert class="text-danger" type="danger" ng-if="EmployeeCtrl.fonctions.length === 0">
                      <i class="fa fa-warning"></i>
                      {{ "FORM.LABELS.FUNCTION" | translate }} <b>{{ "FORM.LABELS.CONTACT_ADMIN" | translate }}</b>
                    </uib-alert>

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.FUNCTION" | translate }}</label>
                    <div class="col-md-9">
                      <ui-select
                        name="fonction_id"
                        ng-model="EmployeeCtrl.employee.fonction_id">
                        <ui-select-match placeholder="{{ 'FORM.SELECT.FUNCTION' | translate }}"><span>{{$select.selected.name}}</span></ui-select-match>
                        <ui-select-choices ui-select-focus-patch repeat="f.id as f.fonction_txt for f in EmployeeCtrl.functions | filter:$select.search | orderBy:'fonction_txt'">
                          <span ng-bind-html="f.fonction_txt | highlight:$select.search"></span>
                        </ui-select-choices>
                      </ui-select>
                    </div>
                  </div>

                   <!-- Employee phone -->
                  <div
                    class="form-group"
                    ng-class="{'has-error' : DetailForm.phone.$invalid && EmployeeRegistrationForm.$submitted}">

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.PHONE" | translate }}</label>
                    <div class="col-md-9">
                      <input
                        class="form-control"
                        name="phone"
                        ng-model="EmployeeCtrl.employee.phone"
                        autocomplete="off">
                      <div class="help-block" ng-messages="DetailForm.phone.$error" ng-show="EmployeeRegistrationForm.$submitted">
                        <div ng-messages-include="modules/templates/messages.tmpl.html"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Employee email -->
                  <div
                    class="form-group"
                    ng-class="{'has-error' : DetailForm.email.$invalid && EmployeeRegistrationForm.$submitted}">

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.EMAIL" | translate }}</label>
                    <div class="col-md-9">
                      <input
                        class="form-control"
                        name="email"
                        ng-model="EmployeeCtrl.employee.email"
                        autocomplete="off">
                      <div class="help-block" ng-messages="DetailForm.email.$error" ng-show="EmployeeRegistrationForm.$submitted">
                        <div ng-messages-include="modules/templates/messages.tmpl.html"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Employee address -->
                  <div
                    class="form-group"
                    ng-class="{'has-error' : DetailForm.adresse.$invalid && EmployeeRegistrationForm.$submitted}">

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.ADDRESS" | translate }}</label>
                    <div class="col-md-9">
                      <input
                        class="form-control"
                        name="adresse"
                        ng-model="EmployeeCtrl.employee.adresse"
                        autocomplete="off">
                      <div class="help-block" ng-messages="DetailForm.adresse.$error" ng-show="EmployeeRegistrationForm.$submitted">
                        <div ng-messages-include="modules/templates/messages.tmpl.html"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Employee bank -->
                  <div
                    class="form-group"
                    ng-class="{'has-error' : DetailForm.bank.$invalid && EmployeeRegistrationForm.$submitted}">

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.BANK" | translate }}</label>
                    <div class="col-md-9">
                      <input
                        class="form-control"
                        name="bank"
                        ng-model="EmployeeCtrl.employee.bank"
                        autocomplete="off">
                      <div class="help-block" ng-messages="DetailForm.bank.$error" ng-show="EmployeeRegistrationForm.$submitted">
                        <div ng-messages-include="modules/templates/messages.tmpl.html"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Employee bank account -->
                  <div
                    class="form-group"
                    ng-class="{'has-error' : DetailForm.bank_account.$invalid && EmployeeRegistrationForm.$submitted}">

                    <label class="col-md-3 control-label">{{ "FORM.LABELS.BANK_ACCOUNT" | translate }}</label>
                    <div class="col-md-9">
                      <input
                        class="form-control"
                        name="bank_account"
                        ng-model="EmployeeCtrl.employee.bank_account"
                        autocomplete="off">
                      <div class="help-block" ng-messages="DetailForm.bank_account.$error" ng-show="EmployeeRegistrationForm.$submitted">
                        <div ng-messages-include="modules/templates/messages.tmpl.html"></div>
                      </div>
                    </div>
                  </div>
                </div>            
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
